generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Facility {
  id          Int          @id @default(autoincrement())
  name        String       @unique() @db.VarChar(50)
  address     String       @db.VarChar(1000)
  imageUrl    String       @db.VarChar(2000)
  rooms       Room[]
  instruments Instrument[]

  @@map("facility")
}

model Room {
  id              Int              @id @default(autoincrement())
  name            String           @db.VarChar(50)
  note            String?          @db.VarChar(1000)
  imageUrl        String           @db.VarChar(2000)
  facilityId      Int              @map("facility_id")
  facility        Facility         @relation(fields: [facilityId], references: [id])
  roomInstruments RoomInstrument[]

  @@unique([facilityId, name])
  @@map("room")
}

model Instrument {
  id              Int                   @id @default(autoincrement())
  name            String
  type            MusicalInstrumentEnum
  status          StatusInstrumentEnum
  price           Decimal               @db.Decimal(11, 0)
  countInStock    Int                   @map("count_in_stock")
  facilityId      Int                   @map("facility_id")
  facility        Facility              @relation(fields: [facilityId], references: [id])
  roomInstruments RoomInstrument[]

  @@unique([type, name])
  @@map("instrument")
}

model RoomInstrument {
  id           Int        @id @default(autoincrement())
  roomId       Int        @map("room_id")
  room         Room       @relation(fields: [roomId], references: [id])
  instrumentId Int        @map("instrument_id")
  instrument   Instrument @relation(fields: [instrumentId], references: [id])
  quantity     Int

  @@unique([roomId, instrumentId])
  @@map("room_instrument")
}

enum MusicalInstrumentEnum {
  PIANO
  GUITAR
  ORGAN
}

enum StatusInstrumentEnum {
  USING
  USED
  NEW
}
